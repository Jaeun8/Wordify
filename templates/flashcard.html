<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>WORDIFY ÎÇ±Îßê Ïπ¥Îìú</title>
    <link rel="stylesheet" href="../static/flashcard.css" />
    <style>
      #popup-msg {
        display: none;
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background-color: #444;
        color: white;
        padding: 15px 25px;
        border-radius: 8px;
        font-size: 16px;
        z-index: 999;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        opacity: 0;
        transition: opacity 0.5s ease;
      }
      #popup-msg.show {
        display: block;
        opacity: 1;
      }
    </style>
  </head>

  <body>
    <header>
      
      <form action="{{ url_for('home') }}">
        <button class="logo" type="submit">WORD<span>IFY</span></button>
      </form>
    
      <nav>
        <ul>
          <li>
            <form action="{{ url_for('streaks_page') }}">
              <button class="nav-btn streaks">Streaks</button>
            </form>
          </li>
          <li>
            <form action="{{ url_for('playlist') }}">
              <button class="nav-btn streaks">Playlist</button>
            </form>
          </li>
          <li>
            <div class="dropdown">
              <button class="dropbtn"> 
                <span class="dropbtn_icon">menu</span>
              </button>
              <div class="dropdown-content">
                <form action="{{ url_for('my_flashcard') }}">
                  <button class="flashcard flashcard-btn">flashcard</button>
                </form>
                <form action="{{ url_for('quiz') }}">
                  <button class="quiz-btn quiz">quiz</button>
                </form>
                <form action="{{ url_for('quiz') }}">
                  <button class="list-btn ">my lists</button>
                </form>
                <li>
                  {% if current_user is defined and current_user.is_authenticated %}
                  <form action="{{ url_for('logout') }}">
                      <button class="nav-btn">Logout</button>
                  </form>
                  {% else %}
                  <form action="{{ url_for('login') }}">
                    <button class="nav-btn">Login/Signup</button>
                  </form>
                  {% endif %}
                </li>
              </div>
            </div>
          </li>
        </ul>
      </nav>
    </header>

    <div id="popup-msg"></div>

    <div class="container">
      <h1 class="title">ÎÇ±Îßê Ïπ¥Îìú</h1>

      <div id="card-area" class="card">
        <div class="card-content">
          <p>
            <strong id="word">
              {% if quiz_words and quiz_words[0]['word'] %}
                {{ quiz_words[0]['word'] }}
              {% else %}
                Îã®Ïñ¥
              {% endif %}
            </strong>
          </p>
          <p id="meaning">
            {% if quiz_words and quiz_words[0]['meaning'] %}
              {{ quiz_words[0]['meaning'] }}
            {% else %}
              Îúª
            {% endif %}
          </p>
        </div>
      </div>
    </div>

    <div class="button-group">
      <button class="prev-btn" onclick="loadPrevWord()">Ïù¥Ï†Ñ Îã®Ïñ¥</button>
      <button class="next-btn" onclick="loadNextWord()">Îã§Ïùå Îã®Ïñ¥</button>
      <form method="get" action="/select" style="display:inline;">
        <button class="next-btn" type="submit">üéµ ÏÉà Îã®Ïñ¥</button>
      </form>
    </div>

    <div class="button-group2">
      <div>
        <form action="{{ url_for('quiz') }}">
          <button class="quiz-go-btn">ÌÄ¥Ï¶àÎ≥¥Í∏∞</button>
        </form>
      </div>
      <div>
        <form id="save-form" method="post" action="{{ url_for('save_to_word_list') }}">
          <input type="hidden" name="words_json" id="words_json">
          <button class="list-go-btn" type="submit">Îã®Ïñ¥Ïû•Ïóê Ï†ÄÏû•ÌïòÍ∏∞</button>
        </form>
      </div>
    </div>

    <script>
      const flashcards = {{ quiz_words | tojson | safe }} || [];
      let currentIndex = 0;

      function showCard(index) {
        if (index < 0 || index >= flashcards.length) {
          alert('Îçî Ïù¥ÏÉÅ Îã®Ïñ¥Í∞Ä ÏóÜÏäµÎãàÎã§.');
          return;
        }
        currentIndex = index;
        document.getElementById('word').textContent = flashcards[currentIndex].word;
        document.getElementById('meaning').textContent = flashcards[currentIndex].meaning;
      }

      function loadNextWord() {
        if (currentIndex + 1 < flashcards.length) {
          showCard(currentIndex + 1);
        } else {
          alert('ÎßàÏßÄÎßâ Îã®Ïñ¥ÏûÖÎãàÎã§.');
        }
      }

      function loadPrevWord() {
        if (currentIndex - 1 >= 0) {
          showCard(currentIndex - 1);
        } else {
          alert('Ï≤´ Îã®Ïñ¥ÏûÖÎãàÎã§.');
        }
      }

      window.onload = () => {
        if (flashcards.length > 0) {
          showCard(0);
        } else {
          document.getElementById('word').textContent = 'Îã®Ïñ¥ ÏóÜÏùå';
          document.getElementById('meaning').textContent = 'Îã®Ïñ¥ Î¶¨Ïä§Ìä∏Í∞Ä ÎπÑÏñ¥ÏûàÏäµÎãàÎã§.';
        }

        const urlParams = new URLSearchParams(window.location.search);
        const message = urlParams.get('message');
        if (message) {
          const popup = document.getElementById('popup-msg');
          if (message === 'saved') {
            popup.textContent = '‚úÖ Îã®Ïñ¥Í∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!';
          } else if (message === 'already_saved') {
            popup.textContent = '‚ö†Ô∏è Ïù¥ÎØ∏ Ï†ÄÏû•Îêú Îã®Ïñ¥ ÏÑ∏Ìä∏ÏûÖÎãàÎã§.';
          } else {
            popup.textContent = '‚ùå Ï†ÄÏû• Ï§ë Î¨∏Ï†úÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.';
          }
          popup.classList.add('show');
          setTimeout(() => {
            popup.classList.remove('show');
          }, 2500);
        }
      };

      const form = document.getElementById('save-form');
      const hiddenInput = document.getElementById('words_json');
      form.addEventListener('submit', function (e) {
        const jsonData = JSON.stringify(flashcards);
        hiddenInput.value = jsonData;
      });
    </script>
  </body>
</html>
